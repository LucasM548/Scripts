<!DOCTYPE html>
<html>

<head>
	<title>Notice Technique - Configuration d'un poste de développement</title>
	<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

	<style>
		/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
		/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

		body {
			font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
			font-size: var(--vscode-markdown-font-size, 14px);
			padding: 0 26px;
			line-height: var(--vscode-markdown-line-height, 22px);
			word-wrap: break-word;
		}

		#code-csp-warning {
			position: fixed;
			top: 0;
			right: 0;
			color: white;
			margin: 16px;
			text-align: center;
			font-size: 12px;
			font-family: sans-serif;
			background-color: #444444;
			cursor: pointer;
			padding: 6px;
			box-shadow: 1px 1px 1px rgba(0, 0, 0, .25);
		}

		#code-csp-warning:hover {
			text-decoration: none;
			background-color: #007acc;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, .25);
		}

		body.scrollBeyondLastLine {
			margin-bottom: calc(100vh - 22px);
		}

		body.showEditorSelection .code-line {
			position: relative;
		}

		body.showEditorSelection .code-active-line:before,
		body.showEditorSelection .code-line:hover:before {
			content: "";
			display: block;
			position: absolute;
			top: 0;
			left: -12px;
			height: 100%;
		}

		body.showEditorSelection li.code-active-line:before,
		body.showEditorSelection li.code-line:hover:before {
			left: -30px;
		}

		.vscode-light.showEditorSelection .code-active-line:before {
			border-left: 3px solid rgba(0, 0, 0, 0.15);
		}

		.vscode-light.showEditorSelection .code-line:hover:before {
			border-left: 3px solid rgba(0, 0, 0, 0.40);
		}

		.vscode-light.showEditorSelection .code-line .code-line:hover:before {
			border-left: none;
		}

		.vscode-dark.showEditorSelection .code-active-line:before {
			border-left: 3px solid rgba(255, 255, 255, 0.4);
		}

		.vscode-dark.showEditorSelection .code-line:hover:before {
			border-left: 3px solid rgba(255, 255, 255, 0.60);
		}

		.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
			border-left: none;
		}

		.vscode-high-contrast.showEditorSelection .code-active-line:before {
			border-left: 3px solid rgba(255, 160, 0, 0.7);
		}

		.vscode-high-contrast.showEditorSelection .code-line:hover:before {
			border-left: 3px solid rgba(255, 160, 0, 1);
		}

		.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
			border-left: none;
		}

		img {
			max-width: 100%;
			max-height: 100%;
		}

		a {
			text-decoration: none;
		}

		a:hover {
			text-decoration: underline;
		}

		a:focus,
		input:focus,
		select:focus,
		textarea:focus {
			outline: 1px solid -webkit-focus-ring-color;
			outline-offset: -1px;
		}

		hr {
			border: 0;
			height: 2px;
			border-bottom: 2px solid;
		}

		h1 {
			padding-bottom: 0.3em;
			line-height: 1.2;
			border-bottom-width: 1px;
			border-bottom-style: solid;
		}

		h1,
		h2,
		h3 {
			font-weight: normal;
		}

		table {
			border-collapse: collapse;
		}

		table>thead>tr>th {
			text-align: left;
			border-bottom: 1px solid;
		}

		table>thead>tr>th,
		table>thead>tr>td,
		table>tbody>tr>th,
		table>tbody>tr>td {
			padding: 5px 10px;
		}

		table>tbody>tr+tr>td {
			border-top: 1px solid;
		}

		blockquote {
			margin: 0 7px 0 5px;
			padding: 0 16px 0 10px;
			border-left-width: 5px;
			border-left-style: solid;
		}

		code {
			font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
			font-size: 1em;
			line-height: 1.357em;
		}

		body.wordWrap pre {
			white-space: pre-wrap;
		}

		pre:not(.hljs),
		pre.hljs code>div {
			padding: 16px;
			border-radius: 3px;
			overflow: auto;
		}

		pre code {
			color: var(--vscode-editor-foreground);
			tab-size: 4;
		}

		/** Theming */

		.vscode-light pre {
			background-color: rgba(220, 220, 220, 0.4);
		}

		.vscode-dark pre {
			background-color: rgba(10, 10, 10, 0.4);
		}

		.vscode-high-contrast pre {
			background-color: rgb(0, 0, 0);
		}

		.vscode-high-contrast h1 {
			border-color: rgb(0, 0, 0);
		}

		.vscode-light table>thead>tr>th {
			border-color: rgba(0, 0, 0, 0.69);
		}

		.vscode-dark table>thead>tr>th {
			border-color: rgba(255, 255, 255, 0.69);
		}

		.vscode-light h1,
		.vscode-light hr,
		.vscode-light table>tbody>tr+tr>td {
			border-color: rgba(0, 0, 0, 0.18);
		}

		.vscode-dark h1,
		.vscode-dark hr,
		.vscode-dark table>tbody>tr+tr>td {
			border-color: rgba(255, 255, 255, 0.18);
		}
	</style>

	<style>
		/* Tomorrow Theme */
		/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
		/* Original theme - https://github.com/chriskempson/tomorrow-theme */

		/* Tomorrow Comment */
		.hljs-comment,
		.hljs-quote {
			color: #8e908c;
		}

		/* Tomorrow Red */
		.hljs-variable,
		.hljs-template-variable,
		.hljs-tag,
		.hljs-name,
		.hljs-selector-id,
		.hljs-selector-class,
		.hljs-regexp,
		.hljs-deletion {
			color: #c82829;
		}

		/* Tomorrow Orange */
		.hljs-number,
		.hljs-built_in,
		.hljs-builtin-name,
		.hljs-literal,
		.hljs-type,
		.hljs-params,
		.hljs-meta,
		.hljs-link {
			color: #f5871f;
		}

		/* Tomorrow Yellow */
		.hljs-attribute {
			color: #eab700;
		}

		/* Tomorrow Green */
		.hljs-string,
		.hljs-symbol,
		.hljs-bullet,
		.hljs-addition {
			color: #718c00;
		}

		/* Tomorrow Blue */
		.hljs-title,
		.hljs-section {
			color: #4271ae;
		}

		/* Tomorrow Purple */
		.hljs-keyword,
		.hljs-selector-tag {
			color: #8959a8;
		}

		.hljs {
			display: block;
			overflow-x: auto;
			color: #4d4d4c;
			padding: 0.5em;
		}

		.hljs-emphasis {
			font-style: italic;
		}

		.hljs-strong {
			font-weight: bold;
		}
	</style>

	<style>
		/*
 * Markdown PDF CSS
 */

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
			padding: 0 12px;
		}

		pre {
			background-color: #f8f8f8;
			border: 1px solid #cccccc;
			border-radius: 3px;
			overflow-x: auto;
			white-space: pre-wrap;
			overflow-wrap: break-word;
		}

		pre:not(.hljs) {
			padding: 23px;
			line-height: 19px;
		}

		blockquote {
			background: rgba(127, 127, 127, 0.1);
			border-color: rgba(0, 122, 204, 0.5);
		}

		.emoji {
			height: 1.4em;
		}

		code {
			font-size: 14px;
			line-height: 19px;
		}

		/* for inline code */
		:not(pre):not(.hljs)>code {
			color: #C9AE75;
			/* Change the old color so it seems less like an error */
			font-size: inherit;
		}

		/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
		.page {
			page-break-after: always;
		}
	</style>

	<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>

<body>
	<script>
		mermaid.initialize({
			startOnLoad: true,
			theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
				? 'dark'
				: 'default'
		});
	</script>
	<h1 id="notice-technique---configuration-dun-poste-de-d%C3%A9veloppement">Notice Technique - Configuration d'un
		poste de développement</h1>
	<p>MARTINATI Lucas - CHARLES SAMUEL</p>
	<hr>
	<p>Ceci est une <strong>notice</strong> vous montrant les étapes à suivre pour <strong>configurer un poste de
			développement</strong> de manière propre et efficace.
		Vous allez créer un nouvel utilisateur, installer des logiciels de base, prendre en main un script de création
		d'utilisateur et gérer les logs de celui-ci.</p>
	<h1 id="deux-m%C3%A9thodes-soffrent-%C3%A0-vous">Deux méthodes s'offrent à vous :</h1>
	<h3 id="vous-pouvez-lancer-un-script-qui-fera-tout-%C3%A0-votre-place-en-suivant-les-%C3%A9tapes-suivantes">Vous
		pouvez lancer un script qui fera tout à votre place, en suivant les étapes suivantes :</h3>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt install git
</div></code></pre>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<p>Clonage du dépôt et lancement du script d'installation automatique :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">clone</span> https://github.com/LucasM548/SAE-S1-3.git /SAE
<span class="hljs-built_in">sudo</span> bash /SAE/Installation
</div></code></pre>
	<p>Les informations suivantes vous seront demandées :</p>
	<ul>
		<li><strong>Mot de passe</strong> sécurisé (min. 8 caractères, pas un palindrome).</li>
		<li><strong>Répéter votre mot de passe</strong>.</li>
		<li><strong>Votre nom</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de chambre</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de téléphone professionnel</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de téléphone personnel</strong> <em>(optionnel)</em>.</li>
		<li><strong>Une autre information</strong> <em>(optionnelle)</em>.</li>
	</ul>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<p>Lors de l'installation, une boîte de dialogue demande si les non-superutilisateurs doivent être autorisés à
		capturer des paquets. Vous devez répondre <code>OUI</code>.</p>
	<p>Après cela, si vous voulez des précisions sur le script d'automatisation de création d'utilisateur, dirigez vous
		vers <a href="#6-script-dautomatisation-de-cr%C3%A9ation-dutilisateurs">6. Script d'Automatisation de Création
			d'Utilisateurs</a></p>
	<hr>
	<h3 id="ou-vous-pouvez-suivre-chaque-%C3%A9tape-une-par-une">Ou vous pouvez suivre chaque étape une par une :</h3>
	<h2 id="table-des-mati%C3%A8res">Table des matières</h2>
	<ul>
		<li><a href="#1-cr%C3%A9ation-du-groupe-et-de-lutilisateur">1. Création du groupe et de l'utilisateur</a></li>
		<li><a href="#2-installation-des-logiciels">2. Installation des Logiciels</a></li>
		<li><a href="#3-installation-et-configuration-des-scripts">3. Installation et Configuration des Scripts</a></li>
		<li><a href="#4-configuration-des-services-systemd">4. Configuration des Services Systemd</a></li>
		<li><a href="#5-rotation-des-logs-logrotate">5. Rotation des Logs (Logrotate)</a></li>
		<li><a href="#6-script-dautomatisation-de-cr%C3%A9ation-dutilisateurs">6. Script d'Automatisation de Création
				d'Utilisateurs</a></li>
		<li><a href="#7-terminer">7. Terminer</a></li>
	</ul>
	<h2 id="1-cr%C3%A9ation-du-groupe-et-de-lutilisateur">1. Création du groupe et de l'utilisateur</h2>
	<p>Commandes à effectuer pour créer un groupe testgroup et un utilisateur testuser :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> groupadd testgroup
<span class="hljs-built_in">sudo</span> adduser testuser
</div></code></pre>
	<p>Lors de la création de <code>testuser</code>, les informations suivantes vous seront demandées :</p>
	<ul>
		<li><strong>Mot de passe</strong> sécurisé (min. 8 caractères, pas un palindrome).</li>
		<li><strong>Répéter votre mot de passe</strong>.</li>
		<li><strong>Votre nom</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de chambre</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de téléphone professionnel</strong> <em>(optionnel)</em>.</li>
		<li><strong>Votre numéro de téléphone personnel</strong> <em>(optionnel)</em>.</li>
		<li><strong>Une autre information</strong> <em>(optionnelle)</em>.</li>
	</ul>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<p>L'ajout de <code>testuser</code> au groupe <code>testgroup</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> adduser testuser testgroup
</div></code></pre>
	<img src="Screen/groupadd.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<h2 id="2-installation-des-logiciels">2. Installation des logiciels</h2>
	<p>Vous devez installer un ensemble de logiciels requis :</p>
	<p>Avant toute installation, il faut mettre à jour la liste des paquets :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt update
</div></code></pre>
	<img src="Screen/aptUpdate.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<hr>
	<p>Installation de <code>emacs</code>, <code>apache2</code>, <code>java</code> et <code>javac</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt install emacs apache2 default-jdk
</div></code></pre>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).</p>
	<img src="Screen/installEmacsApaJava.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<p>Installation de <code>wireshark</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt install wireshark
</div></code></pre>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).
		<img src="Screen/installWireshark.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	</p>
	<p>Lors de l'installation, une boîte de dialogue demande si les non-superutilisateurs doivent être autorisés à
		capturer des paquets. Vous devez répondre <code>OUI</code>.</p>
	<img src="Screen/superUserWireshark.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<p>Vérification que le groupe <code>wireshark</code> a bien été créé :</p>
	<pre class="hljs"><code><div>getent group wireshark
</div></code></pre>
	<img src="Screen/verifGroup.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<p>Ajout de <code>testuser</code> au groupe <code>wireshark</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> usermod -aG wireshark testuser
</div></code></pre>
	<p><em>Justification :</em> Cette configuration permet à <code>testuser</code> d'effectuer des captures sans avoir
		besoin des droits <code>root</code> (sudo). La commande <code>usermod -aG</code> ajoute le groupe
		<code>wireshark</code> à <code>testuser</code> sans supprimer les groupes de <code>testuser</code> existants.
		(-a : append, -G : group)</p>
	<p><em>Note :</em> Sous Debian, vous pouvez simplement utiliser sudo <code>adduser testuser wireshark</code>.
		Toutefois, la commande <code>usermod</code> est présentée ici car elle fonctionne sur toutes les distributions
		Linux.</p>
	<h2 id="3-installation-et-configuration-des-scripts">3. Installation et configuration des scripts</h2>
	<p>Pour la gestion des scripts, il faut récupérer les fichiers depuis un dépôt Git.</p>
	<h3 id="r%C3%A9cup%C3%A9ration-des-scripts">Récupération des scripts</h3>
	<p>Installation de <strong>git</strong> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt install git
</div></code></pre>
	<p><strong>Confirmer les informations</strong> en tapant <code>y</code> (ou <code>O</code> en français).
		<img src="Screen/installGit.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	</p>
	<p>Clonage du dépôt :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">clone</span> https://github.com/LucasM548/SAE-S1-3.git /SAE
</div></code></pre>
	<p><em>Note :</em> Le dépôt contient tous les <strong>scripts</strong>, mais également des <strong>fichiers de
			configuration</strong> et des <strong>services systemd</strong> <em>(qui seront nécessaire lors de la suite
			de la configuration)</em>.
		<img src="Screen/cloneGit.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	</p>
	<h3 id="permissions">Permissions</h3>
	<p>Donner les droits d'exécution et de lecture appropriés au dossier <code>/SAE</code> pour qu'il soit accessible
		par tous les utilisateurs, mais modifiable uniquement par <code>root</code>.</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> -R 755 /SAE
</div></code></pre>
	<p><em>Choix des droits 755 :</em></p>
	<ul>
		<li>Propriétaire (root) : Lecture, Écriture, Exécution (7)</li>
		<li>Groupe/Autres : Lecture, Exécution (5)
			Cela permet aux utilisateurs d'exécuter les scripts (<code>srm</code>, <code>lkt</code>, etc.) sans pouvoir
			les modifier.</li>
	</ul>
	<p>Ajouter le chemin <code>/SAE/Scripts</code> au <code>PATH</code> de l'utilisateur <code>testuser</code> en
		modifiant son fichier <code>.bashrc</code> pour qu'il ait accès aux scripts poubelle depuis n'importe quel
		répertoire :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=$PATH:/SAE/Scripts&#x27;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> -a <span class="hljs-string">&quot;/home/testuser/.bashrc&quot;</span>
</div></code></pre>
	<p><em>Justification :</em> L'utilisation de <code>sudo tee -a</code> permet d'ajouter la ligne au fichier
		<code>.bashrc</code> avec les droits administrateur, évitant ainsi les problèmes de permissions, le
		<code>-a</code> signifie <code>append</code> et permet d'ajouter le contenu au fichier sans le remplacer.</p>
	<p><em>Note :</em> Vous pouvez simplement utiliser la commande
		<code>echo 'export PATH=$PATH:/SAE/Scripts' &gt;&gt; /home/testuser/.bashrc</code>, mais uniquement si
		l'utilisateur est <code>root</code>, avec la commande <code>sudo -u</code>.</p>
	<hr>
	<h2 id="4-configuration-des-services-systemd">4. Configuration des Services Systemd</h2>
	<p>Vous devez configurer plusieurs services pour qu'ils se lancent automatiquement au démarrage.</p>
	<h3 id="serveur-apache2">Serveur Apache2</h3>
	<p>Activation et lancement du service :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> apache2
<span class="hljs-built_in">sudo</span> systemctl start apache2
</div></code></pre>
	<p><em>Explication :</em> <code>enable</code> crée les liens symboliques nécessaires pour que systemd lance le
		service à chaque démarrage. <code>start</code> lance le service immédiatement sans attendre le redémarrage.</p>
	<img src="Screen/systemEnable.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<p>Accès à la Notive version web : Le site avec la notice est déplacé vers la racine du serveur web
		(<code>/var/www/html</code>) pour qu'il soit accessible via <code>http://127.0.0.1</code>.</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /SAE/Notice/* /var/www/html/
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -d /SAE/Notice
</div></code></pre>
	<p><em>Justification :</em> <code>Apache2</code> va automatiquement chercher dans <code>/var/www/html/</code> un
		fichier <code>index.html</code>, on a donc ajouté l’index.html de notre notice directement à cette adresse.</p>
	<img src="Screen/index.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<h2 id="5-rotation-des-logs-logrotate">5. Rotation des Logs (Logrotate)</h2>
	<p>Un service est mis en place pour surveiller les modifications du fichier <code>/var/log/install.log</code> et
		enregistrer la date de modification dans <code>/var/log/date_install.log</code>.</p>
	<p>Création du fichier de log <code>date_install.log</code> et <code>install.log</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /var/log/date_install.log
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">touch</span> /var/log/install.log
</div></code></pre>
	<p>Déplacement des fichiers de définition systemd (<code>.path</code> et <code>.service</code>) vers
		<code>/etc/systemd/system/</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /SAE/install-log.path /etc/systemd/system/
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /SAE/install-log.service /etc/systemd/system/
</div></code></pre>
	<p>Activation du service :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> systemctl daemon-reload
<span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> install-log.path
<span class="hljs-built_in">sudo</span> systemctl start install-log.path
</div></code></pre>
	<p><em>Justification :</em></p>
	<ul>
		<li><code>daemon-reload</code> : Permet à systemd de recharger les services et de prendre en compte les nouveaux
			fichiers ajoutés.</li>
		<li><code>install-log.path</code> : Ce service &quot;path&quot; surveille le fichier et déclenche le service
			associé (<code>install-log.service</code>) lorsque le fichier <code>install.log</code> est modifié.</li>
	</ul>
	<img src="Screen/systemctl.png" style="border-radius: 7px; display: block; margin: 0 auto;">
	<h3 id="le-contenu-de-install-logpath">Le contenu de install-log.path :</h3>
	<pre class="hljs"><code><div>[Unit]
Description=Surveille les modifications de install.log

[Path]
# Surveille les modifications du fichier var/log/install.log
PathChanged=/var/log/install.log
# Appelle le service install-log.service lors d&#x27;un changement
Unit=install-log.service

[Install]
# Active le chemin lors du démarrage du système
WantedBy=multi-user.target
</div></code></pre>
	<h3 id="le-contenu-de-install-logservice">Le contenu de install-log.service :</h3>
	<pre class="hljs"><code><div>[Unit]
Description=Ajoute la date dans date_install.log

[Service]
# Indique que ce service exécute la commande et s&#x27;arrête juste après
Type=oneshot
# Lorsque que le service est appelé, ajoute la date actuelle dans le fichier date_install.log (on utilise pas uniquement bash car systemd n&#x27;a pas le path)
ExecStart=/bin/bash -c &#x27;date &gt;&gt; /var/log/date_install.log&#x27;
</div></code></pre>
	<p>Pour éviter que les fichiers de logs ne saturent l'espace disque, Il faut configurer <code>logrotate</code>.</p>
	<h3 id="configuration-pour-installlog">Configuration pour <code>install.log</code></h3>
	<p>Il faut créer un fichier de configuration dans <code>/etc/logrotate.d/</code> avec les paramètres suivants :</p>
	<ul>
		<li><code>size 200</code> : Rotation dès que le fichier dépasse 200 octets.</li>
		<li><code>rotate 5</code> : Conserver les 5 dernières archives.</li>
		<li><code>compress</code> : Compresser les archives.</li>
		<li><code>create</code> : Créer un nouveau fichier log vide après la rotation.</li>
		<li><code>missingok</code> : Ne pas générer d'erreur si le fichier est absent.</li>
	</ul>
	<p>Commande :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /SAE/install-log /etc/logrotate.d/
</div></code></pre>
	<h3 id="contenu-de-install-log">Contenu de install-log :</h3>
	<pre class="hljs"><code><div>/var/log/install.log {
    size 200
    rotate 5
    compress
    create
    missingok
}
</div></code></pre>
	<p><em>Note :</em> <code>logrotate</code> est un outil de rotation des logs qui permet de conserver les logs dans un
		fichier compressé et de conserver un nombre maximum de fichiers.</p>
	<h3 id="configuration-pour-dateinstalllog">Configuration pour <code>date_install.log</code></h3>
	<p>De même pour le fichier de dates :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /SAE/date_install /etc/logrotate.d/
</div></code></pre>
	<h3 id="contenu-de-dateinstall">Contenu de date_install :</h3>
	<pre class="hljs"><code><div>/var/log/date_install.log {
    size 200
    rotate 5
    compress
    create
    missingok
}
</div></code></pre>
	<h2 id="6-script-dautomatisation-de-cr%C3%A9ation-dutilisateurs">6. Script d'automatisation de création
		d'utilisateurs</h2>
	<p>Le script nommé <code>addUser</code> disponible dans le dossier <code>/SAE</code> permet la création
		d'utilisateurs à partir d'un fichier de configuration.</p>
	<h3 id="fonctionnement-du-script">Fonctionnement du script</h3>
	<p>Le script lit un fichier <code>config.txt</code> ligne par ligne. Pour chaque ligne
		(<code>login,group,homedir,skeldir</code>), il effectue les actions suivantes :</p>
	<ol>
		<li>Création de l'utilisateur avec <code>useradd</code>.</li>
		<li>Configuration du répertoire personnel (home) avec les sous-dossiers <code>Documents</code> et
			<code>Downloads</code>.</li>
		<li>Configuration du fichier <code>.bashrc</code> pour inclure le chemin des scripts (<code>/SAE</code>) dans le
			<code>PATH</code>.</li>
		<li>Création des alias <code>e</code> pour <code>emacs</code> et <code>w</code> pour <code>wireshark</code>.
		</li>
		<li>Enregistrement des opérations dans <code>/var/log/install.log</code>.</li>
	</ol>
	<p><em>Note :</em> Un script <code>removeUser</code> est également disponible pour supprimer les utilisateurs et les
		groupes contenu dans le même fichier <code>config.txt</code>. De plus, nous avons choisi de créer les
		répertoires <code>Documents</code> et <code>Downloads</code> ainsi que de modifier le fichier
		<code>.bashrc</code> individuellement pour chaque utilisateur, plutôt que de modifier le skel global. Sa évite
		les éventuels oublis (alias, PATH, répertoires manquants) lors de la création manuelle de nouveaux skel par
		l'administrateur.</p>
	<p>Le script <code>addUser</code> :</p>
	<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># commande addUser qui permet de créer des utilisateurs</span>

<span class="hljs-comment"># Vérifie qu&#x27;il y a exactement un argument</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne 1 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># \033[33m avec le -e permet de mettre le texte en jaune</span>
    <span class="hljs-comment"># et \033[0m permet de remettre la couleur blanche (sinon toutes les prochaines lignes seront en jaune)</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[33m====== Usage: <span class="hljs-variable">$0</span> &lt;fichier_config&gt; ======\033[0m&quot;</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Vérifie que l&#x27;argument est bien un fichier valide</span>
<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># \033[31m avec le -e permet de mettre le texte en rouge</span>
    <span class="hljs-comment"># et \033[0m permet de remettre la couleur blanche (sinon toutes les prochaines lignes seront en rouge)</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31m====== Erreur : <span class="hljs-variable">$1</span> n&#x27;est pas un fichier valide ======\033[0m&quot;</span>
    <span class="hljs-built_in">exit</span> 2
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Vérifie que l&#x27;utilisateur a bien lancé le script en mode administrateur (avec un sudo avant)</span>
<span class="hljs-comment"># Lorsque qu&#x27;on fait un sudo id -u, ça renvoie 0 car on a l&#x27;UID 0</span>
<span class="hljs-comment"># Evite le $(whoami) = &quot;root&quot; car si un utilisateur s&#x27;appelle root, le script va fonctionner</span>
<span class="hljs-keyword">if</span> [ $(<span class="hljs-built_in">id</span> -u) -ne 0 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31m====== Erreur : Le script doit être exécuté en mode administrateur (sudo) ======\033[0m&quot;</span>
    <span class="hljs-built_in">exit</span> 3
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Stocke le nombre de lignes du fichier configuration</span>
nbLines=$(<span class="hljs-built_in">wc</span> -l &lt; <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>) <span class="hljs-comment"># Le &lt; permet de retourner uniquement le nombre de lignes</span>

<span class="hljs-built_in">mkdir</span> -p /var/log
<span class="hljs-built_in">touch</span> /var/log/install.log
<span class="hljs-built_in">log</span>=<span class="hljs-string">&quot;/var/log/install.log&quot;</span>

<span class="hljs-comment"># Analyse de chaque ligne du fichier</span>
<span class="hljs-keyword">for</span> ((i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-variable">$nbLines</span>+<span class="hljs-number">1</span>; i++)); <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># Stocke la ligne numéro i dans une variable (le tr -d &quot; &quot; permet de supprimer les espaces)</span>
    Lines=$(sed -n <span class="hljs-string">&quot;<span class="hljs-variable">${i}</span>p&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&quot; &quot;</span>)
    <span class="hljs-comment"># Le &lt;&lt;&lt; permet d&#x27;envoyer une chaîne de caractères sans utiliser un echo avec un pipe</span>
    user=$(<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;,&#x27;</span> -f1 &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$Lines</span>&quot;</span>)
    group=$(<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;,&#x27;</span> -f2 &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$Lines</span>&quot;</span>)
    rephome=$(<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;,&#x27;</span> -f3 &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$Lines</span>&quot;</span>)
    repskel=$(<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;,&#x27;</span> -f4 &lt;&lt;&lt; <span class="hljs-string">&quot;<span class="hljs-variable">$Lines</span>&quot;</span>)

    <span class="hljs-comment"># le -z permet de vérifier si la variable est vide</span>
    <span class="hljs-comment"># (- z pour Zero, elle vérifie si la chaîne est de longueur nulle)</span>
    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$Lines</span>&quot;</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># Si la ligne est vide, on passe à la suivante (si la fin à un saut de ligne ou non, ça fonctionneras)</span>
        <span class="hljs-built_in">continue</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">if</span> [ $(awk -F<span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;{print NF}&#x27;</span> &lt;&lt;&lt; <span class="hljs-variable">$Lines</span>) = 4 ] &amp;&amp; [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$repskel</span>&quot;</span> ]&amp;&amp; [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>&quot;</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-comment"># le -f permet de ne rien faire si le groupe existe déjà</span>
            groupadd -f <span class="hljs-string">&quot;<span class="hljs-variable">$group</span>&quot;</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Le groupe <span class="hljs-variable">$group</span> a été créé&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
            <span class="hljs-comment"># le &gt; /dev/null 2&gt;&amp;1 sert à rediriger les potentiels message d&#x27;erreur</span>
            useradd -m -k <span class="hljs-string">&quot;<span class="hljs-variable">$repskel</span>&quot;</span> -d <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>&quot;</span> -g <span class="hljs-string">&quot;<span class="hljs-variable">$group</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$user</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span> 2&gt;&amp;1
            <span class="hljs-keyword">if</span> [ $? = 0 ]; <span class="hljs-keyword">then</span>
                <span class="hljs-comment"># \033[32m avec le -e permet de mettre le texte en vert</span>
                <span class="hljs-comment"># et \033[0m permet de remettre la couleur blanche (sinon toutes les prochaines lignes seront en vert)</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L&#x27;utilisateur <span class="hljs-variable">$user</span> a été créé avec le répertoire <span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span> et le squelette <span class="hljs-variable">$repskel</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
                <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32m====== L&#x27;utilisateur <span class="hljs-variable">$user</span> a bien été créé dans le groupe <span class="hljs-variable">$group</span> ======\033[0m&quot;</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== L&#x27;utilisateur <span class="hljs-variable">$user</span> a bien été créé dans le groupe <span class="hljs-variable">$group</span> ======&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
                <span class="hljs-comment"># mkdir -p pour créer les fichiers Downloads et Documents s&#x27;ils ne sont pas encore créés</span>
                <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/Downloads&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/Documents&quot;</span>
                <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/.bashrc&quot;</span> ]; <span class="hljs-keyword">then</span>
                    <span class="hljs-built_in">touch</span> <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/.bashrc&quot;</span>
                    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Le fichier .bashrc a été créé&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
                <span class="hljs-keyword">fi</span>

                <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;alias e=&#x27;emacs&#x27;\nalias w=&#x27;wireshark&#x27;&quot;</span> &gt;&gt; <span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/.bashrc
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Les alias e pour &#x27;emacs&#x27; et w pour &#x27;wireshark&#x27; ont été ajoutés pour l&#x27;utilisateur <span class="hljs-variable">$user</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>

                <span class="hljs-comment"># Ajouter le path /Scripts à la suite des paths déjà présents dans le fichier .bashrc</span>
                <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27;export PATH=&quot;$PATH:/SAE/Scripts&quot;&#x27;</span> &gt;&gt; <span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>/.bashrc
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Le path &#x27;/SAE/Scripts&#x27; a bien été ajouté au .bashrc de l&#x27;utilisateur <span class="hljs-variable">$user</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>

                <span class="hljs-comment"># Rendre les dossiers à l&#x27;utilisateur (sinon ils sont à root)</span>
                <span class="hljs-built_in">chown</span> -R <span class="hljs-string">&quot;<span class="hljs-variable">$user</span>:<span class="hljs-variable">$group</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span>&quot;</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Les droits du dossier <span class="hljs-variable">$rephome</span>/<span class="hljs-variable">$user</span> ont bien été donnés à <span class="hljs-variable">$user</span> du groupe <span class="hljs-variable">$group</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>

                <span class="hljs-comment"># AJouter l&#x27;utilisateur dans le groupe wireshark pour qu&#x27;il puisse l&#x27;utiliser</span>
                adduser <span class="hljs-variable">$user</span> wireshark &gt;&gt; <span class="hljs-variable">$log</span> 2&gt;&amp;1
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L&#x27;utilisateur <span class="hljs-variable">$user</span> a été ajouté au groupe wireshark&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
            <span class="hljs-keyword">else</span>
                <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31m====== Erreur : L&#x27;utilisateur <span class="hljs-variable">$user</span> n&#x27;a pas pu être ajouté (il existe peut-être déjà) ======\033[0m&quot;</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== Erreur : L&#x27;utilisateur <span class="hljs-variable">$user</span> n&#x27;a pas pu être ajouté (il existe peut-être déjà) ======&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31m====== Erreur : La ligne <span class="hljs-variable">$i</span> est défaillante ======\033[0m&quot;</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== Erreur : La ligne <span class="hljs-variable">$i</span> est défaillante ======&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;================================================&quot;</span> &gt;&gt; <span class="hljs-variable">$log</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</div></code></pre>
	<h3 id="ex%C3%A9cution">Exécution</h3>
	<p>Exemple de commande utilisée :</p>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> bash /SAE/addUser /SAE/config.txt
</div></code></pre>
	<p><em>Extrait du fichier de configuration (<code>config.txt</code>) :</em></p>
	<pre class="hljs"><code><div>u1, g1, /home, /etc/skel/
u2, g1, /home, /etc/skel/
</div></code></pre>
	<p><em>Note :</em> Remplir le contenu de config.txt avec les utilisateurs que vous voulez créer (ne pas utiliser de
		chemin contenant des espaces).</p>
	<img src="Screen/testScript.png" style="border-radius: 7px; display: block; margin: 0 auto">
	<h2 id="7-terminer">7. Terminer</h2>
	<p>Le système est désormais configuré :</p>
	<ul>
		<li>Un utilisateur <code>testuser</code>.</li>
		<li>Plusieurs logiciels installés et configurés (<code>emacs</code>, <code>apache2</code>,
			<code>wireshark</code>, <code>javac</code> et <code>java</code>).</li>
		<li>Un Script <code>addUser</code> qui permet de créer des utilisateurs.</li>
		<li>Un serveur web hébergeant cette notice.</li>
		<li>Un système de surveillance et de rotation des logs de <code>addUser</code>.</li>
		<li>Vous pouvez lancer ce script pour vérifier que tout est bien installé :</li>
	</ul>
	<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> bash /SAE/verifConfig
</div></code></pre>
	<p><em>Note :</em> Ce script vérifie la présence des logiciels, des utilisateurs, des services systemd et des
		configurations de logrotate.</p>
	<img src="Screen/verifConfig.png" style="border-radius: 7px; display: block; margin: 0 auto">
</body>

</html>